<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Writ & Reckoning Lore Builder</title>
  <style>
    body { background: #1a1a1a; color: #eee; font-family: sans-serif; padding: 2em; max-width: 900px; margin: auto; }
    h1, h2, h3 { color: #ffcb05; }
    label { display: block; margin-top: 1em; font-weight: bold; }
    input, textarea, select {
      width: 100%;
      padding: 0.5em;
      margin-top: 0.25em;
      border: none;
      background: #2a2a2a;
      color: #fff;
    }
    textarea { height: 8em; resize: vertical; }
    .section { margin-top: 2em; }
    .insert-button {
      margin-top: 0.5em;
      display: flex;
      gap: 0.5em;
    }
    button {
      padding: 0.5em 1em;
      background: #444;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #666; }
  </style>
</head>
<body>
  <h1>ðŸŒ€ Writ & Reckoning Lore Builder</h1>

  <div class="section">
    <h2>Step 1: Name the Core Powers & Concepts</h2>

    <label>Name for the high power of Chaos</label>
    <input type="text" id="ChaosPower" placeholder="Chaos">

    <label>Name for the high power of Nature</label>
    <input type="text" id="NaturePower" placeholder="Sora">

    <label>Name for the high power of Entropy and Time</label>
    <input type="text" id="EntropyPower" placeholder="Karn">

    <label>Name for the high power of Order</label>
    <input type="text" id="OrderPower" placeholder="Virel">

    <label>Name for the first authority / regulator of reality</label>
    <input type="text" id="Warden" placeholder="The Warden">

    <label>Name for the crystalized source of possibility</label>
    <input type="text" id="Geode" placeholder="The Geode of Possibility">

    <label>Name for magical objects (cards, shards, etc.)</label>
    <input type="text" id="Forms" placeholder="Forms">

    <label>Name for containers of power (equipment, spirits, etc.)</label>
    <input type="text" id="Vessels" placeholder="Vessels">

    <label>Name for physical manifestation of magic buildup</label>
    <input type="text" id="Soulrocks" placeholder="Soulrocks">
  </div>

  <div class="section">
    <h2>Step 2: World Lore</h2>

    <label>Creation Myth</label>
    <textarea id="creationLore">
In the age before variance, {{Warden}} kept reality carefully ordered within {{Geode}}, a star that contained every possibility. {{ChaosPower}} shattered this control, stealing fragments that would become the first {{Forms}}.
    </textarea>
    <div class="insert-button">
      <select id="creationInsert">
        <option value="">Insert Object...</option>
      </select>
      <button onclick="insertObject('creationLore', 'creationInsert')">Add Object</button>
    </div>

    <label>Nature of Magic</label>
    <textarea id="magicLore">
Magic flows through {{Vessels}}, which channel {{Forms}} into the world. As power builds, {{Soulrocks}} emerge from the body â€” solid echoes of emotional communion with the Powers.
    </textarea>
    <div class="insert-button">
      <select id="magicInsert">
        <option value="">Insert Object...</option>
      </select>
      <button onclick="insertObject('magicLore', 'magicInsert')">Add Object</button>
    </div>

    <label>The Rebellion of the Powers</label>
    <textarea id="rebellionLore">
When {{ChaosPower}} first rebelled, it was {{NaturePower}} who followed, and then {{EntropyPower}}, and finally {{OrderPower}}. Together they defied {{Warden}}, scattering {{Forms}} into mortal hands.
    </textarea>
    <div class="insert-button">
      <select id="rebellionInsert">
        <option value="">Insert Object...</option>
      </select>
      <button onclick="insertObject('rebellionLore', 'rebellionInsert')">Add Object</button>
    </div>
  </div>

  <button onclick="downloadPDF()">ðŸ“„ Export as PDF</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const objectMap = {
      ChaosPower: "Chaos",
      NaturePower: "Sora",
      EntropyPower: "Karn",
      OrderPower: "Virel",
      Warden: "The Warden",
      Geode: "The Geode of Possibility",
      Forms: "Forms",
      Vessels: "Vessels",
      Soulrocks: "Soulrocks"
    };

    function getObjectLabel(id) {
      return document.getElementById(id).value || objectMap[id];
    }

    function applyObjects(text) {
      Object.keys(objectMap).forEach(key => {
        const value = getObjectLabel(key);
        const regex = new RegExp(`{{${key}}}`, 'g');
        text = text.replace(regex, value);
      });
      return text;
    }

    function insertObject(textareaId, selectId) {
      const select = document.getElementById(selectId);
      const value = select.value;
      if (!value) return;

      const textarea = document.getElementById(textareaId);
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const text = textarea.value;
      const insertion = `{{${value}}}`;

      textarea.value = text.slice(0, start) + insertion + text.slice(end);
      textarea.focus();
      textarea.setSelectionRange(start + insertion.length, start + insertion.length);
    }

    // Populate dropdowns
    function populateDropdowns() {
      const options = Object.keys(objectMap).map(key =>
        `<option value="${key}">${objectMap[key]}</option>`
      ).join("");
      ["creationInsert", "magicInsert", "rebellionInsert"].forEach(id => {
        document.getElementById(id).innerHTML += options;
      });
    }

    async function downloadPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const sections = [
        ["Creation Myth", document.getElementById("creationLore").value],
        ["Nature of Magic", document.getElementById("magicLore").value],
        ["Rebellion of the Powers", document.getElementById("rebellionLore").value]
      ];

      let y = 10;
      doc.setFont("Times", "Normal");

      sections.forEach(([title, raw]) => {
        const text = applyObjects(raw);
        doc.setFontSize(14);
        doc.text(title, 10, y);
        y += 8;

        doc.setFontSize(11);
        const lines = doc.splitTextToSize(text, 180);
        doc.text(lines, 10, y);
        y += lines.length * 6 + 10;

        if (y > 270) {
          doc.addPage();
          y = 10;
        }
      });

      doc.save("custom-lore.pdf");
    }

    populateDropdowns();
  </script>
</body>
</html>
